<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÎëòÍ∏∞Ïùò Î™®Ìóò (Verb Dungeon)</title>
    <!-- [NEW] Ìè∞Ìä∏ Î≥ÄÍ≤Ω: Í∞ÄÎèÖÏÑ±Ïù¥ Ï¢ãÍ≥† Í∑ÄÏó¨Ïö¥ 'Jua'Ï≤¥ Ï†ÅÏö© -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">

    <style>
        /* --- Í∏∞Î≥∏ Ïä§ÌÉÄÏùº --- */
        :root {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --accent-color: #d32f2f;
            --ui-bg: rgba(30, 30, 30, 0.95);
            --gold: #ffd700;
            --easy-color: #4caf50;
            --hard-color: #9c27b0;
            --book-color: #f4e4bc;
            --ink-color: #2c2c2c;
        }

        * { box-sizing: border-box; user-select: none; }

        body {
            background-color: #000;
            color: var(--text-color);
            /* [NEW] Ï†ÑÏ≤¥ Ìè∞Ìä∏ Î≥ÄÍ≤Ω: Jua */
            font-family: 'Jua', sans-serif;
            margin: 0; padding: 0;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; overflow: hidden;
            font-size: 1.1rem;
        }

        #app-container {
            width: 100%; max-width: 480px; height: 100%;
            background: var(--bg-color);
            position: relative;
            display: flex; flex-direction: column;
            border-left: 1px solid #333; border-right: 1px solid #333;
            overflow: hidden;
        }

        .screen {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            display: none;
            flex-direction: column;
            align-items: center;
            background-size: cover; background-position: center;
            padding: 20px;
        }

        .active { display: flex; }

        /* --- ÏãúÏûë ÌôîÎ©¥ --- */
        #start-screen {
            justify-content: center;
            background-color: #111;
            background-image: url('assets/bg_start.png');
            background-size: cover;
            background-position: center;
        }

        .main-title { 
            font-family: 'Jua', sans-serif;
            font-size: 3.5rem; /* ÌÅ¨Í∏∞ Ï°∞Ï†ï */
            color: var(--gold); margin: 0; text-align: center;
            text-shadow: 
                -2px -2px 0 #000,  
                 2px -2px 0 #000,
                -2px  2px 0 #000,
                 2px  2px 0 #000,
                 0 0 15px rgba(255, 215, 0, 0.5); 
            line-height: 1.2;
            letter-spacing: 2px;
        }
        
        .pulse-btn {
            padding: 15px 60px; font-size: 1.8rem;
            background: var(--accent-color); color: white;
            border: 3px solid white; border-radius: 50px; cursor: pointer;
            animation: pulse 1.5s infinite; 
            font-family: 'Jua', sans-serif;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            margin-top: 50px;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* --- ÎÇúÏù¥ÎèÑ ÏÑ†ÌÉù --- */
        #difficulty-screen { 
            justify-content: center; 
            background-color: #1a1a1d;
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('assets/bg_start.png');
            background-size: cover;
            background-position: center;
        }
        .select-title { margin-bottom: 30px; font-size: 2rem; color: white; text-shadow: 2px 2px 4px black; }
        .char-container { display: flex; gap: 20px; justify-content: center; width: 100%; margin-bottom: 40px; }
        .char-card {
            width: 45%; height: 280px;
            background: rgba(44, 44, 44, 0.9);
            border: 3px solid #555; border-radius: 15px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 10px; cursor: pointer; transition: transform 0.2s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .char-card:hover { transform: translateY(-5px); border-color: white; }
        
        .char-img-placeholder {
            width: 110px; height: 110px; background: #444; margin-bottom: 20px;
            display: flex; justify-content: center; align-items: center;
            font-size: 3rem; border-radius: 50%; overflow: hidden;
            border: 3px solid #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .char-img-placeholder img { width: 100%; height: 100%; object-fit: cover; }
        .fallback-text { z-index: 0; color: #888; font-size: 2rem; }
        
        .easy-mode { border-color: var(--easy-color); }
        .hard-mode { border-color: var(--hard-color); }
        
        .char-card h3 { font-size: 1.5rem; margin-top: 10px; color: white; }

        .collection-btn {
            background: rgba(0, 0, 0, 0.6); border: 2px solid var(--gold);
            color: var(--gold); padding: 15px 40px; border-radius: 10px;
            font-size: 1.3rem; cursor: pointer; display: flex; align-items: center; gap: 10px;
            font-family: 'Jua', sans-serif;
        }
        .collection-btn:hover { background: rgba(255, 215, 0, 0.2); }

        /* --- Ïä§ÌÖåÏù¥ÏßÄ ÏÑ†ÌÉù --- */
        #stage-select-screen { 
            justify-content: flex-start; background-color: #111; 
            overflow-y: auto; padding-bottom: 50px;
            -ms-overflow-style: none; scrollbar-width: none;
        }
        #stage-select-screen::-webkit-scrollbar { display: none; }
        
        .stage-grid {
            display: flex; flex-direction: column-reverse; align-items: center;
            width: 100%; max-width: 320px; gap: 60px;
            margin-top: 40px; padding-bottom: 40px; position: relative;
        }
        .stage-grid::before {
            content: ''; position: absolute; top: 20px; bottom: 20px; left: 50%;
            width: 6px; background: #333; transform: translateX(-50%); z-index: 0; border-radius: 3px;
        }
        .stage-btn {
            width: 120px; height: 120px; background: #222; border: 3px solid #555;
            border-radius: 20px; display: flex; flex-direction: column;
            justify-content: center; align-items: center; cursor: pointer;
            color: #aaa; transition: all 0.2s; position: relative; z-index: 1;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .stage-btn:nth-child(odd) { align-self: flex-start; margin-left: 20px; }
        .stage-btn:nth-child(even) { align-self: flex-end; margin-right: 20px; }
        
        .stage-btn:hover { border-color: white; color: white; background: #333; transform: scale(1.1); }
        .stage-btn.cleared { border-color: var(--gold); color: var(--gold); background: #2a2a2a; box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
        .stage-btn.locked { border-color: #333; background: #1a1a1d; color: #444; cursor: pointer; }
        .stage-verb { font-size: 1.5rem; margin-bottom: 5px; color:inherit;}

        /* --- ÎèÑÍ∞ê --- */
        #collection-screen { background-color: #111; justify-content: flex-start; }
        .collection-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
            width: 100%; margin-top: 20px; overflow-y: auto;
        }
        #collection-screen .collection-grid::-webkit-scrollbar { display: none; }
        .card-slot {
            aspect-ratio: 2/3; background: #222; border: 1px solid #444;
            display: flex; justify-content: center; align-items: center;
            color: #555; font-size: 0.9rem; flex-direction: column; text-align: center;
            border-radius: 5px; position: relative; overflow: hidden;
        }
        .card-slot img { width: 90%; height: 60%; object-fit: contain; margin-bottom: 5px; z-index: 1; }
        .card-slot.unlocked { background: linear-gradient(135deg, #2c2c2c, #1a1a1d); border: 2px solid gold; color: gold; box-shadow: inset 0 0 10px rgba(255, 215, 0, 0.2); }
        .back-btn { align-self: flex-start; background: none; border: none; color: white; font-size: 2.5rem; cursor: pointer; }

        /* --- Í≤åÏûÑ ÌôîÎ©¥ --- */
        #game-screen { padding: 0; }
        .battle-field { 
            flex-grow: 1; width: 100%;
            display: flex; flex-direction: column; justify-content: space-between; 
            padding: 20px; 
            background-color: #222;
            background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('assets/bg_battle.png');
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        .status-bar { 
            padding: 10px 15px; background: var(--ui-bg); width: 100%;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #444; font-size: 1.1rem;
        }
        .quit-btn { background: transparent; border: 1px solid #666; color: #aaa; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.9rem; font-family: inherit; }
        .quit-btn:hover { background: #333; color: white; }

        .monster-area, .hero-area { display: flex; flex-direction: column; align-items: center; position: relative; }
        
        .sprite { 
            width: 150px; height: 150px; 
            background: rgba(0,0,0,0.3); 
            display: flex; justify-content: center; align-items: center; 
            border-radius: 10px; margin: 10px 0; font-size: 3rem; overflow: hidden;
            transition: all 0.5s ease;
            position: relative;
        }
        .sprite img { width: 100%; height: 100%; object-fit: contain; position: absolute; z-index: 1; }
        .sprite .fallback-icon { z-index: 0; }

        .phase-2 .sprite { transform: scale(1.1); filter: drop-shadow(0 0 10px gold); }
        .phase-3 .sprite { transform: scale(1.2); filter: drop-shadow(0 0 15px red); animation: angry-shake 2s infinite; }
        
        @keyframes angry-shake {
            0% { transform: scale(1.2) rotate(0deg); }
            2% { transform: scale(1.2) rotate(-2deg); }
            4% { transform: scale(1.2) rotate(2deg); }
            6% { transform: scale(1.2) rotate(0deg); }
            100% { transform: scale(1.2) rotate(0deg); }
        }

        /* [NEW] Ï§ëÏïô ÎåÄÏÇ¨Ï∞Ω Ïä§ÌÉÄÏùº ÏàòÏ†ï (Î∞ïÏä§ Ï†úÍ±∞, Í∏ÄÏî®Îßå Îë•Îë•) */
        .battle-message {
            position: absolute;
            top: 55%; left: 50%; /* ÏúÑÏπò ÎØ∏ÏÑ∏ Ï°∞Ï†ï */
            transform: translate(-50%, -50%);
            /* Î∞∞Í≤Ω Î∞è ÌÖåÎëêÎ¶¨ Ï†úÍ±∞ */
            background: none;
            border: none;
            box-shadow: none;
            
            color: #fff;
            width: 100%;
            text-align: center;
            z-index: 20;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s, transform 0.3s;
            
            /* Í∏ÄÏî® Í∞ïÏ°∞ (ÎëêÍ∫ºÏö¥ ÌÖåÎëêÎ¶¨ Ìö®Í≥º) */
            font-size: 1.8rem;
            font-weight: bold;
            text-shadow: 
                -2px -2px 0 #000,  
                 2px -2px 0 #000,
                -2px  2px 0 #000,
                 2px  2px 0 #000,
                 0 0 10px rgba(0,0,0,0.5);
        }
        .battle-message.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.1);
        }
        .battle-message span { color: var(--gold); }

        .hp-bar-container { width: 120px; height: 12px; background: #333; border-radius: 6px; overflow: hidden; border: 1px solid #555; }
        .hp-fill { height: 100%; background: #f44336; transition: width 0.3s; }

        .control-panel { background: var(--ui-bg); width: 100%; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        #q-area-wrapper { display: flex; flex-direction: column; align-items: center; margin-bottom: 5px; }
        #tense-label { color: var(--gold); font-size: 1.2rem; margin-bottom: 10px; display: flex; align-items: center; gap: 5px; }
        .hint-btn { background: none; border: none; cursor: pointer; font-size: 1.5rem; animation: float 2s infinite ease-in-out; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
        #q-text { text-align: center; line-height: 1.6; font-size: 1.4rem; width: 100%; word-break: keep-all; }
        
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; }
        .option-btn { 
            background: #333; border: 2px solid #555; color: white; 
            padding: 15px 5px; border-radius: 10px; cursor: pointer; 
            font-size: 1.2rem; font-family: inherit; transition: background 0.1s; 
        }
        .option-btn:active { background: #555; transform: scale(0.98); }
        .option-btn:disabled { background: #222; color: #555; border-color: #333; cursor: not-allowed; transform: none; }
        #feedback { text-align: center; height: 25px; color: gold; font-size: 1.1rem; font-weight: bold; }

        /* --- Î™®Îã¨Îì§ --- */
        #custom-modal { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: #222; border: 2px solid var(--gold); padding: 30px; border-radius: 15px; text-align: center; width: 85%; max-width: 320px; box-shadow: 0 0 30px rgba(0,0,0,0.8); }
        .modal-text { color: white; margin-bottom: 30px; line-height: 1.5; font-size: 1.3rem; }
        .modal-btn-group { display: flex; justify-content: center; gap: 15px; }
        .modal-btn { padding: 10px 30px; border-radius: 8px; cursor: pointer; border: none; font-weight: bold; font-family: inherit; font-size: 1.1rem; }
        .btn-confirm { background: var(--accent-color); color: white; }
        .btn-cancel { background: #555; color: white; }

        #hint-modal { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; justify-content: center; align-items: center; padding: 20px; }
        .book-container { width: 100%; max-width: 360px; background-color: var(--book-color); color: var(--ink-color); padding: 30px 20px; border-radius: 5px 15px 15px 5px; box-shadow: inset 10px 0 20px rgba(0,0,0,0.2), 10px 10px 30px rgba(0,0,0,0.5); position: relative; font-family: 'Courier New', serif; display: flex; flex-direction: column; border: 8px solid #5d4037; }
        .book-close-btn { position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 2rem; color: #8b0000; cursor: pointer; font-weight: bold; }
        .book-title { text-align: center; font-size: 1.6rem; font-weight: bold; margin-bottom: 20px; border-bottom: 3px double #8b4513; padding-bottom: 10px; color: #8b4513; }
        .book-section { margin-bottom: 20px; }
        .book-label { font-weight: bold; color: #a0522d; font-size: 1.1rem; margin-bottom: 5px; }
        .book-text { font-size: 1.1rem; line-height: 1.6; word-break: keep-all; font-family: 'Jua', sans-serif; }
        .highlight { color: #d32f2f; font-weight: bold; background: rgba(255, 255, 0, 0.2); padding: 0 4px; border-radius: 4px;}

    </style>
</head>
<body>

    <div id="app-container">
        <!-- ÏïåÎ¶º Î™®Îã¨ -->
        <div id="custom-modal">
            <div class="modal-content">
                <p class="modal-text" id="modal-msg">ÏïåÎ¶º ÎÇ¥Ïö©</p>
                <div class="modal-btn-group" id="modal-btns">
                    <button class="modal-btn btn-confirm">ÌôïÏù∏</button>
                </div>
            </div>
        </div>

        <!-- ÌûåÌä∏Î∂Å Î™®Îã¨ -->
        <div id="hint-modal">
            <div class="book-container">
                <button class="book-close-btn" onclick="closeHint()">‚úï</button>
                <div class="book-title">Adventurer's Note</div>
                <div class="book-section">
                    <div class="book-label">üìú Ìï¥ÏÑù (Translation)</div>
                    <div class="book-text" id="hint-kor">...</div>
                </div>
                <div class="book-section">
                    <div class="book-label">üí° Í≥µÎûµ (Tip)</div>
                    <div class="book-text" id="hint-desc">...</div>
                </div>
            </div>
        </div>

        <!-- ÏãúÏûë ÌôîÎ©¥ -->
        <div id="start-screen" class="screen active">
            <h1 class="main-title">ÎëòÍ∏∞'s<br>ADVENTURE</h1>
            <button class="pulse-btn" onclick="showScreen('difficulty-screen')">START</button>
        </div>

        <!-- ÎÇúÏù¥ÎèÑ ÏÑ†ÌÉù -->
        <div id="difficulty-screen" class="screen">
            <h2 class="select-title">ÎÇúÏù¥ÎèÑ ÏÑ†ÌÉù</h2>
            <div class="char-container">
                <div class="char-card easy-mode" onclick="selectDifficulty('easy')">
                    <div class="char-img-placeholder" id="select-easy-img">
                        <span class="fallback-text">üê£</span>
                        <img src="assets/hero_easy.png" onload="this.style.display='block'; this.previousElementSibling.style.display='none';" onerror="this.style.display='none'; this.previousElementSibling.style.display='block';">
                    </div>
                    <h3>Í≤¨Ïäµ Í∏∞ÏÇ¨</h3>
                </div>
                <div class="char-card hard-mode" onclick="selectDifficulty('hard')">
                    <div class="char-img-placeholder" id="select-hard-img">
                        <span class="fallback-text">ü¶Ö</span>
                        <img src="assets/hero_hard.png" onload="this.style.display='block'; this.previousElementSibling.style.display='none';" onerror="this.style.display='none'; this.previousElementSibling.style.display='block';">
                    </div>
                    <h3>ÎßàÏä§ÌÑ∞</h3>
                </div>
            </div>
            <button class="collection-btn" onclick="showScreen('collection-screen')">
                <span>üìñ</span> Î™¨Ïä§ÌÑ∞ ÎèÑÍ∞ê
            </button>
        </div>

        <!-- Ïä§ÌÖåÏù¥ÏßÄ ÏÑ†ÌÉù -->
        <div id="stage-select-screen" class="screen">
            <div style="width:100%; display:flex; align-items:center;">
                <button class="back-btn" onclick="showScreen('difficulty-screen')">‚Üê</button>
                <h2 class="select-title" style="margin:0 auto 0 20px;">ÎçòÏ†Ñ ÏÑ†ÌÉù</h2>
            </div>
            <div class="stage-grid" id="stage-grid"></div>
        </div>

        <!-- ÎèÑÍ∞ê -->
        <div id="collection-screen" class="screen">
            <button class="back-btn" onclick="showScreen('difficulty-screen')">‚Üê</button>
            <h2 style="color:var(--gold);">Î™¨Ïä§ÌÑ∞ ÎèÑÍ∞ê</h2>
            <div class="collection-grid" id="collection-grid"></div>
        </div>

        <!-- Í≤åÏûÑ ÌîåÎ†àÏù¥ -->
        <div id="game-screen" class="screen">
            <div class="status-bar">
                <button class="quit-btn" onclick="tryQuitGame()">üè≥Ô∏è Ìè¨Í∏∞</button>
                <span id="stage-text">STAGE 1</span>
                <span>LIFE: <span id="hero-hp-text">5</span></span>
            </div>

            <div class="battle-field" id="battle-bg">
                <!-- [NEW] ÎßêÌíçÏÑ† ÎåÄÏã† Ï§ëÏïô ÎåÄÏÇ¨Ï∞Ω -->
                <div class="battle-message" id="battle-msg">ÎåÄÏÇ¨Í∞Ä Ïó¨Í∏∞Ïóê ÎÇòÏòµÎãàÎã§</div>

                <div class="monster-area" id="monster-container">
                    <div class="hp-bar-container"><div class="hp-fill" id="monster-hp-bar" style="width: 100%;"></div></div>
                    
                    <div class="sprite">
                        <span class="fallback-icon" style="position: absolute; z-index: 0;">üëæ</span>
                        <img id="game-monster-img" src="" alt="Monster" style="display:none;" 
                             onload="this.style.display='block';" 
                             onerror="this.style.display='none';">
                    </div>
                    
                    <span id="monster-name" style="font-weight:bold;">Monster</span>
                </div>
                
                <div class="hero-area">
                    <span id="game-hero-name" style="font-size:0.8rem; margin-bottom:5px;">Hero</span>
                    
                    <div class="sprite">
                         <span class="fallback-icon" style="position: absolute; z-index: 0;">‚öîÔ∏è</span>
                         <img id="game-hero-img" src="" alt="Hero" style="display:none;" 
                              onload="this.style.display='block';" 
                              onerror="this.style.display='none';">
                    </div>
                </div>
            </div>

            <div class="control-panel">
                <div id="q-area-wrapper">
                    <div id="tense-label">
                        <span id="tense-text">ÌòÑÏû¨</span>
                    </div>
                    <div id="q-text">Î¨∏Ï†ú Î°úÎî©Ï§ë...</div>
                </div>
                <div id="options-area" class="options-grid"></div>
                <div id="feedback"></div>
            </div>
        </div>
    </div>

    <script>
        /* --- 1. Ïú†Ìã∏Î¶¨Ìã∞ & Î™®Îã¨ --- */
        const modal = document.getElementById('custom-modal');
        const modalMsg = document.getElementById('modal-msg');
        const modalBtns = document.getElementById('modal-btns');

        function showAlert(msg, callback) {
            modalMsg.innerText = msg;
            modalBtns.innerHTML = `<button class="modal-btn btn-confirm" id="modal-ok-btn">ÌôïÏù∏</button>`;
            modal.style.display = 'flex';
            document.getElementById('modal-ok-btn').onclick = function() {
                modal.style.display = 'none';
                if(callback) callback();
            };
        }

        function showConfirm(msg, yesCallback) {
            modalMsg.innerText = msg;
            modalBtns.innerHTML = `
                <button class="modal-btn btn-cancel" id="modal-no-btn">Ï∑®ÏÜå</button>
                <button class="modal-btn btn-confirm" id="modal-yes-btn">ÌôïÏù∏</button>
            `;
            modal.style.display = 'flex';
            document.getElementById('modal-yes-btn').onclick = function() {
                modal.style.display = 'none';
                if(yesCallback) yesCallback();
            };
            document.getElementById('modal-no-btn').onclick = function() {
                modal.style.display = 'none';
            };
        }
        
        const hintModal = document.getElementById('hint-modal');
        function showHint(kor, desc) {
            document.getElementById('hint-kor').innerText = kor;
            document.getElementById('hint-desc').innerHTML = desc; 
            hintModal.style.display = 'flex';
        }
        function closeHint() { hintModal.style.display = 'none'; }

        /* --- 2. Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞ --- */
        const verbs = [
            { word: "see", forms: ["see", "saw", "seen", "seeing", "sees"], monster: "Cyclops", dialogues: ["ÎÑàÎ•º ÏßÄÏºúÎ≥¥Í≥† ÏûàÎã§...", "ÎÇ¥ ÏãúÏïºÍ∞Ä ÎÑìÏñ¥ÏßÑÎã§!", "Ïñ¥Îîú Ïà®ÏúºÎ†§Í≥†!!"] },
            { word: "eat", forms: ["eat", "ate", "eaten", "eating", "eats"], monster: "Ogre", dialogues: ["Î∞∞Í∞Ä Í≥†ÌîÑÍµ∞...", "Îçî ÎßéÏùÄ Í≥†Í∏∞Í∞Ä ÌïÑÏöîÌï¥!", "ÎºàÍπåÏßÄ ÏîπÏñ¥Ï£ºÎßà!"] },
            { word: "do", forms: ["do", "did", "done", "doing", "does"], monster: "Golem", dialogues: ["Î™ÖÎ†πÏùÑ ÏàòÌñâÌïúÎã§.", "Ï†ÑÌà¨ Î™®Îìú Í∞ÄÎèô.", "ÏãúÏä§ÌÖú Í≥ºÎ∂ÄÌïò! ÌååÍ¥¥!"] },
            { word: "bring", forms: ["bring", "brought", "bringing", "brings"], monster: "Bat", dialogues: ["ÏÑ†Î¨ºÏùÑ Í∞ÄÏ†∏ÏôîÏßÄ...", "ÌîºÎ•º Î∞îÏ≥êÎùº!", "Ïñ¥Îë†Ïù¥ ÎÑàÎ•º ÎçÆÏπúÎã§!"] },
            { word: "feel", forms: ["feel", "felt", "feeling", "feels"], monster: "Ghost", dialogues: ["ÌïúÍ∏∞Í∞Ä ÎäêÍª¥ÏßÄÎäêÎÉê...", "Í≥µÌè¨Ïóê Îñ®Ïñ¥Îùº!", "ÏòÅÌòºÏùÑ ÏñºÎ†§Ï£ºÎßà!"] },
            { word: "get", forms: ["get", "got", "gotten", "getting", "gets"], monster: "Thief", dialogues: ["Í∞ÄÏßÑ Í±∏ Îã§ ÎÇ¥ÎÜî.", "Ïö¥Ïù¥ Ï¢ãÍµ∞...", "ÎÑ§ Î™©Ïà®ÏùÑ ÌõîÏπòÍ≤†Îã§!"] },
            { word: "say", forms: ["say", "said", "saying", "says"], monster: "Parrot", dialogues: ["Îî∞ÎùºÌï¥Î¥ê Íπç!", "Î™©ÏÜåÎ¶¨Í∞Ä ÏûëÎã§!", "ÎπÑÎ™ÖÏù¥ÎÇò ÏßàÎü¨Îùº!!"] },
            { word: "look", forms: ["look", "looked", "looking", "looks"], monster: "Watcher", dialogues: ["Ïñ¥Îîú Î≥¥Îäî Í±∞ÎÉê.", "ÎÇ¥ ÎààÏùÑ ÌîºÌï† Ïàú ÏóÜÎã§.", "Ïã¨Ïó∞ÏùÑ Î≥¥ÏïÑÎùº!"] },
            { word: "want", forms: ["want", "wanted", "wanting", "wants"], monster: "Mimic", dialogues: ["ÏõêÌï¥... Îçî ÏõêÌï¥...", "ÌÉêÏöïÏù¥ ÎÅìÏñ¥Ïò§Î•∏Îã§!", "ÎÑàÏùò Î™®Îì† Í±∏ ÎÇ¥ÎÜî!"] }
        ];

        const highlight = (text) => `<span class="highlight">${text}</span>`;
        function generateQuestions(verbObj) {
            const v = verbObj.word;
            const f = verbObj.forms; 
            const p = (v === 'be') ? 'was/were' : f[1]; 
            const pp = f[2];
            const ing = f[3];
            
            return [
                { t: "Í≥ºÍ±∞", q: `I ____ him yesterday.`, a: p, kor: `ÎÇòÎäî Ïñ¥Ï†ú Í∑∏Î•º Î≥¥ÏïòÎã§.`, desc: `${highlight('yesterday')}Îäî Í≥ºÍ±∞ ÏãúÏ†êÏûÖÎãàÎã§. Í≥ºÍ±∞Ìòï ${highlight(p)}Í∞Ä Ï†ïÎãµ.` },
                { t: "ÌòÑÏû¨", q: `I usually ____ it every day.`, a: v, kor: `ÎÇòÎäî Î≥¥ÌÜµ Îß§Ïùº Í∑∏Í≤ÉÏùÑ ÌïúÎã§.`, desc: `${highlight('usually')}Îäî ÏäµÍ¥ÄÏùÑ ÎÇòÌÉÄÎÉÖÎãàÎã§. ÌòÑÏû¨Ìòï ${highlight(v)} ÏÇ¨Ïö©.` },
                { t: "ÎØ∏Îûò", q: `I will ____ you later.`, a: v, kor: `ÎÇòÏ§ëÏóê Ìï† Í≤ÉÏù¥Îã§.`, desc: `Ï°∞ÎèôÏÇ¨ ${highlight('will')} Îí§ÏóêÎäî ÏõêÌòï ${highlight(v)}Í∞Ä ÏòµÎãàÎã§.` },
                { t: "Í≥ºÍ±∞ÏßÑÌñâ", q: `I was ____ when you called.`, a: ing, kor: `Ï†ÑÌôîÌñàÏùÑ Îïå ~ÌïòÎäî Ï§ëÏù¥ÏóàÎã§.`, desc: `Í≥ºÍ±∞ ÏßÑÌñâ Ï§ëÏù∏ ÎèôÏûë. 'was + ${highlight('ing')}'` },
                { t: "ÌòÑÏû¨ÏßÑÌñâ", q: `Look! He is ____ now.`, a: ing, kor: `ÏßÄÍ∏à ~ÌïòÍ≥† ÏûàÎã§.`, desc: `ÌòÑÏû¨ ÏßÑÌñâ Ï§ë. 'is + ${highlight('ing')}'` },
                { t: "ÎØ∏ÎûòÏßÑÌñâ", q: `I will be ____ at 8 PM.`, a: ing, kor: `8ÏãúÏóê ~ÌïòÍ≥† ÏûàÏùÑ Í≤ÉÏù¥Îã§.`, desc: `ÎØ∏Îûò ÏßÑÌñâ. 'will be + ${highlight('ing')}'` },
                { t: "Í≥ºÍ±∞ÏôÑÎ£å", q: `He had ____ before I arrived.`, a: pp, kor: `ÎèÑÏ∞© Ï†ÑÏóê Ïù¥ÎØ∏ ~ÌñàÏóàÎã§.`, desc: `ÎåÄÍ≥ºÍ±∞. 'had + ${highlight('p.p')}'` },
                { t: "ÌòÑÏû¨ÏôÑÎ£å", q: `I have just ____ lunch.`, a: pp, kor: `Î∞©Í∏à ~ÌñàÎã§.`, desc: `ÏôÑÎ£å. 'have + ${highlight('p.p')}'` },
                { t: "ÎØ∏ÎûòÏôÑÎ£å", q: `I will have ____ by tomorrow.`, a: pp, kor: `ÎÇ¥ÏùºÏù¥Î©¥ ~ÌñàÏùÑ Í≤ÉÏù¥Îã§.`, desc: `ÎØ∏Îûò ÏôÑÎ£å. 'will have + ${highlight('p.p')}'` },
                { t: "Í≥ºÍ±∞ÏôÑÎ£åÏßÑÌñâ", q: `I had been ____ for 2 hours.`, a: ing, kor: `2ÏãúÍ∞Ñ ÎèôÏïà ~ÌñàÏóàÎã§.`, desc: `Í≥ºÍ±∞ ÏôÑÎ£å ÏßÑÌñâ. 'had been + ${highlight('ing')}'` },
                { t: "ÌòÑÏû¨ÏôÑÎ£åÏßÑÌñâ", q: `I have been ____ since morning.`, a: ing, kor: `ÏïÑÏπ®Î∂ÄÌÑ∞ ~Ìï¥Ïò§Í≥† ÏûàÎã§.`, desc: `ÌòÑÏû¨ ÏôÑÎ£å ÏßÑÌñâ. 'have been + ${highlight('ing')}'` },
                { t: "ÎØ∏ÎûòÏôÑÎ£åÏßÑÌñâ", q: `I will have been ____ for a year.`, a: ing, kor: `1ÎÖÑÏß∏ ~ÌïòÎäî ÏÖàÏùº Í≤ÉÏù¥Îã§.`, desc: `ÎØ∏Îûò ÏôÑÎ£å ÏßÑÌñâ. 'will have been + ${highlight('ing')}'` }
            ];
        }

        const gameData = verbs.map((v, idx) => ({
            id: idx,
            verb: v.word,
            monsterName: v.monster,
            dialogues: v.dialogues,
            forms: v.forms,
            hp: 120, 
            questions: generateQuestions(v)
        }));

        /* --- 3. ÏÉÅÌÉú Î≥ÄÏàò --- */
        let gameState = {
            mode: 'easy',       
            selectedStageId: 0, 
            qList: [],          
            qIndex: 0,
            mMaxHP: 120, mCurHP: 120,
            heroLives: 5,
            currentPhase: 1, 
            clearedStages: { easy: [], hard: [] }
        };

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            if(screenId === 'stage-select-screen') renderStageGrid();
            if(screenId === 'collection-screen') renderCollection();
        }

        function selectDifficulty(mode) {
            gameState.mode = mode;
            showScreen('stage-select-screen');
        }

        /* --- Ïä§ÌÖåÏù¥ÏßÄ Î†åÎçîÎßÅ (ÏàòÏ†ï: ÌÅ¥Î¶≠ Î∞òÏùë Î∞è Ïä§ÌÅ¨Î°§) --- */
        function renderStageGrid() {
            const grid = document.getElementById('stage-grid');
            grid.innerHTML = "";
            const currentCleared = gameState.clearedStages[gameState.mode];
            let firstUnlockedBtn = null; // ÏûêÎèô Ïä§ÌÅ¨Î°§ÏùÑ ÏúÑÌïú ÌÉÄÍ≤ü

            gameData.forEach(stage => {
                const btn = document.createElement('div');
                const isCleared = currentCleared.includes(stage.id);
                const isUnlocked = stage.id === 0 || currentCleared.includes(stage.id - 1);
                
                let btnClass = 'stage-btn';
                if (isCleared) btnClass += ' cleared';
                if (!isUnlocked) btnClass += ' locked';
                btn.className = btnClass;
                
                if (isUnlocked) {
                    btn.onclick = () => startGame(stage.id);
                    btn.innerHTML = `<div class="stage-verb">${stage.verb.toUpperCase()}</div><div class="stage-monster">${stage.monsterName}</div>${isCleared ? '<div>‚≠ê Clear</div>' : ''}`;
                    if(!firstUnlockedBtn) firstUnlockedBtn = btn; // Í∞ÄÏû• ÎÇÆÏùÄ Îã®Í≥ÑÏùò Ìï¥Í∏à Î≤ÑÌäº Ï†ÄÏû• (Ïó≠ÏàúÏù¥Îùº ÎçÆÏñ¥ÏîåÏõåÏßê)
                    firstUnlockedBtn = btn; // Í≥ÑÏÜç Í∞±Ïã†ÌïòÏó¨ Í∞ÄÏû• ÎÜíÏùÄ(ÌôîÎ©¥ÏÉÅ ÏúÑÏ™Ω) Ìï¥Í∏à Î≤ÑÌäºÏùÑ Ï∞æÍ±∞ÎÇò, ÏïÑÎûòÏ™ΩÏùÑ Ï∞æÍ±∞ÎÇò..
                    // ÌÉë ÏåìÍ∏∞ÎãàÍπå ÏïÑÎûò(id 0)Î∂ÄÌÑ∞ ÏúÑÎ°ú Í∞ê. 
                    // id 0Ïù¥ Ìï¥Í∏à -> id 1 Ïû†ÍπÄ.
                    // Ïä§ÌÅ¨Î°§ÏùÄ ÏïÑÎûò(id 0)Í∞Ä Î≥¥Ïù¥Í≤å Ìï¥Ïïº Ìï®.
                } else {
                    // Ïû†Í∏¥ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú ÏïàÎÇ¥ Î©îÏãúÏßÄ
                    btn.onclick = () => showAlert(`üîí Locked\nÏù¥Ï†Ñ Ï∏µ(${gameData[stage.id-1].verb})ÏùÑ Î®ºÏ†Ä ÌÅ¥Î¶¨Ïñ¥ÌïòÏÑ∏Ïöî!`);
                    btn.innerHTML = `<div style="font-size:1.5rem">üîí</div><div class="stage-verb">???</div>`;
                }
                grid.appendChild(btn);
            });
            
            // [Ï§ëÏöî] Ïä§ÌÅ¨Î°§ÏùÑ Îß® ÏïÑÎûò(1Ï∏µ)Î°ú Ïù¥Îèô
            setTimeout(() => { 
                const screen = document.getElementById('stage-select-screen');
                screen.scrollTop = screen.scrollHeight; 
            }, 100);
        }

        /* --- Í≤åÏûÑ ÏãúÏûë --- */
        function startGame(stageId) {
            gameState.selectedStageId = stageId;
            const data = gameData[stageId];
            
            gameState.heroLives = (gameState.mode === 'easy') ? 5 : 3;
            gameState.qList = [...data.questions].sort(() => Math.random() - 0.5);
            gameState.qIndex = 0;
            gameState.mMaxHP = 120;
            gameState.mCurHP = 120;
            gameState.currentPhase = 1;
            
            const monsterContainer = document.getElementById('monster-container');
            monsterContainer.className = 'monster-area';

            // Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïãú ÏóêÎü¨ Î∞©ÏßÄ (src ÏÑ§Ï†ï Ï†Ñ display Ï¥àÍ∏∞Ìôî ÏïàÌï® - onload/onerrorÍ∞Ä Ï≤òÎ¶¨)
            const heroImgSrc = (gameState.mode === 'easy') ? "assets/hero_easy.png" : "assets/hero_hard.png";
            document.getElementById('game-hero-img').src = heroImgSrc;

            const monsterImgTag = document.getElementById('game-monster-img');
            monsterImgTag.src = `assets/mob_${data.verb}_1.png`;

            document.getElementById('stage-text').innerText = `STAGE: ${data.verb.toUpperCase()}`;
            document.getElementById('monster-name').innerText = data.monsterName;
            
            showScreen('game-screen');
            updateUI();
            showSpeech(data.dialogues[0]);
            loadQuestion();
        }

        /* --- ÌéòÏù¥Ï¶à ÏóÖÎç∞Ïù¥Ìä∏ --- */
        function updatePhase() {
            const nextQIndex = gameState.qIndex; 
            const monsterContainer = document.getElementById('monster-container');
            const data = gameData[gameState.selectedStageId];
            const monsterImgTag = document.getElementById('game-monster-img');

            if (nextQIndex === 4) { 
                gameState.currentPhase = 2;
                monsterContainer.classList.add('phase-2');
                monsterImgTag.src = `assets/mob_${data.verb}_2.png`;
                showSpeech(data.dialogues[1]);
            } else if (nextQIndex === 8) { 
                gameState.currentPhase = 3;
                monsterContainer.classList.add('phase-3');
                monsterImgTag.src = `assets/mob_${data.verb}_3.png`;
                showSpeech(data.dialogues[2]);
            }
        }

        function showSpeech(text) {
            const bubble = document.getElementById('battle-msg'); // [ÏàòÏ†ï] ÎßêÌíçÏÑ† ÎåÄÏã† Ï§ëÏïô Î©îÏãúÏßÄÏ∞Ω ÏÇ¨Ïö©
            bubble.innerHTML = `<span>${text}</span>`;
            bubble.classList.add('show');
            setTimeout(() => { bubble.classList.remove('show'); }, 3000);
        }

        function getDistractors(correctAnswer) {
            const data = gameData[gameState.selectedStageId];
            let forms = data.forms.filter(f => f.toLowerCase() !== correctAnswer.toLowerCase());
            while(forms.length < 3) forms.push("dummy");
            forms.sort(() => Math.random() - 0.5);
            return forms.slice(0, 3);
        }

        function loadQuestion() {
            if (gameState.qIndex >= gameState.qList.length) {
                stageClear();
                return;
            }
            updatePhase();

            const q = gameState.qList[gameState.qIndex];
            const tenseLabel = document.getElementById('tense-label');
            tenseLabel.innerHTML = `<span id="tense-text">[${q.t}]</span>`;
            
            if (gameState.mode === 'easy') {
                const hintBtn = document.createElement('button');
                hintBtn.className = 'hint-btn';
                hintBtn.innerHTML = 'üìñ';
                hintBtn.onclick = () => showHint(q.kor, q.desc);
                tenseLabel.appendChild(hintBtn);
            }

            document.getElementById('q-text').innerHTML = `${q.q}`;
            document.getElementById('feedback').innerText = "";

            const optionsArea = document.getElementById('options-area');
            optionsArea.innerHTML = "";

            const correct = q.a;
            const distractors = getDistractors(correct);
            const options = [correct, ...distractors];
            options.sort(() => Math.random() - 0.5);

            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = (e) => checkAnswer(opt, e.target); 
                optionsArea.appendChild(btn);
            });
        }

        function checkAnswer(selectedInput, btnElement) {
            const currentQ = gameState.qList[gameState.qIndex];
            const correct = currentQ.a;

            if (selectedInput.toLowerCase() === correct.toLowerCase()) {
                gameState.mCurHP -= 10;
                document.getElementById('feedback').innerText = "HIT!";
                document.getElementById('feedback').style.color = "#4caf50";
                updateUI();
                
                if (gameState.mCurHP <= 0) {
                    stageClear();
                } else {
                    gameState.qIndex++;
                    setTimeout(loadQuestion, 800);
                }
            } else {
                gameState.heroLives--;
                document.getElementById('feedback').innerText = "MISS! (Î≤ÑÌäº ÌååÍ¥¥Îê®)";
                document.getElementById('feedback').style.color = "#f44336";
                btnElement.disabled = true;
                btnElement.style.opacity = "0.5";
                updateUI();

                if (gameState.heroLives <= 0) {
                    setTimeout(() => {
                        showAlert("Î™®Îì† ÎùºÏù¥ÌîÑÍ∞Ä ÏÜåÏßÑÎêòÏóàÏäµÎãàÎã§. ÎßàÏùÑÎ°ú Í∑ÄÌôòÌï©ÎãàÎã§.", function() {
                            showScreen('stage-select-screen');
                        });
                    }, 500);
                }
            }
        }

        function stageClear() {
            setTimeout(() => {
                showAlert(`${gameData[gameState.selectedStageId].monsterName} ÌÜ†Î≤å ÏôÑÎ£å!`, function() {
                    if(!gameState.clearedStages[gameState.mode].includes(gameState.selectedStageId)) {
                        gameState.clearedStages[gameState.mode].push(gameState.selectedStageId);
                    }
                    showScreen('stage-select-screen');
                });
            }, 300);
        }

        function updateUI() {
            const maxHP = 120;
            const percent = Math.max(0, (gameState.mCurHP / maxHP) * 100);
            document.getElementById('monster-hp-bar').style.width = `${percent}%`;
            document.getElementById('hero-hp-text').innerText = gameState.heroLives;
        }

        function tryQuitGame() {
            showConfirm("ÎçòÏ†ÑÏùÑ Ìè¨Í∏∞ÌïòÍ≥† ÎÇòÍ∞ÄÏãúÍ≤†ÏäµÎãàÍπå?", function() {
                showScreen('stage-select-screen');
            });
        }

        function renderCollection() {
            const grid = document.getElementById('collection-grid');
            grid.innerHTML = "";
            const currentCleared = gameState.clearedStages[gameState.mode];
            gameData.forEach(stage => {
                const isUnlocked = currentCleared.includes(stage.id);
                const slot = document.createElement('div');
                slot.className = `card-slot ${isUnlocked ? 'unlocked' : ''}`;
                
                if (isUnlocked) {
                    slot.innerHTML = `
                        <img src="assets/mob_${stage.verb}_1.png" onerror="this.style.display='none';">
                        <h3 style="margin:5px">${stage.verb.toUpperCase()}</h3>
                        <p>${stage.monsterName}</p>
                    `;
                } else {
                    slot.innerHTML = `<div style="font-size:1.5rem">üîí</div><br>${stage.verb}`;
                }
                grid.appendChild(slot);
            });
        }
    </script>
</body>
</html>